# 가상 메모리

상태: 컴퓨터구조

[16장. 가상 메모리(1)](https://www.youtube.com/watch?v=p1CTX5L_loc)

### 가상 메모리란?

각 프로그램에 실제 주소가 아닌 가상의 주소를 주는 것, 주기억장치(DRAM)보다 큰 용량을 사용하고자 할 때 이용한다.

### 식당 예제

식당에 자리가 10개밖에 없지만, 주인은 20테이블분의 예약을 받는다. 이래도 된다?

- 시간의 차이를 두고 방문하기 때문

20테이블분의 예약을 받았으면, 실제로 필요한 자리는 20테이블이지만, 10개밖에 없으므로 그 자리를 다른 사람에게 주기도 하는 것.

### 개념

CPU에서 어떤 프로그램을 돌리는 데 있어서 필요한 공간이 2GB임. 그런데 메인 메모리에는 256메가의 공간밖에 없음. 이 때, 하드디스크를 확장해서 씀.

가상 메모리 기법은 하드디스크의 공간을 확장해서 메인 메모리 공간으로 이용하는 것.

### 가상 주소가 해결하고 있는 두 가지

- 선 할당으로 인한 부담
    - 운영체제에서는 프로세스를 생성할 때마다 4GB(32bit에서)의 메모리 공간을 할당해줌
    - 매 프로세스마다 이렇게 할당해버리면(1mb의 프로그램이라도) 낭비가 심함
- 느린 속도의 개선
    - RAM의 공간이 부족하면 하드디스크(느림)의 공간을 이용함.

### 가상 주소와 물리 주소

- 가상 주소: 관점이 RAM에 있음.
    - 실질적인 주소는 RAM에만 할당이 됨. 하드디스크에도 할당할 수는 있지만, 이를 실질적으로 물리 주소로 보지 않음.
    - 하드디스크에 할당하는 주소는

![Untitled](%E1%84%80%E1%85%A1%E1%84%89%E1%85%A1%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%86%E1%85%A9%205dc9d/Untitled.png)

### 선 할당으로 인한 부담 해결책

- 우리가 짠 프로그램이 2G의 공간을 필요로 하면, CPU도 그대로 이만큼의 공간을 요구함
- 그러면 MMU라는 녀석이 실제로 그만큼의 공간이 있는 것처럼 CPU가 느끼도록 컨트롤을 함
    - 이 때, CPU는 메모리로 직접 접근하지 않고, MMU를 통해서 요청을 한다.
- MMU는 블럭 단위로 RAM의 메모리를 할당함
    - 다음 블럭의 용도를 MMU가 순간적으로 결정함
        - CPU가 36K번지부터 20바이트를 할당 요구하면, 36~40K의 블록을 다음으로 바로 할당해버림
    - 가상 메모리 관점에서 보면, 다음 블록은 36~40K지만, 실제 물리 메모리 관점에서 보면 이는 4K~8K임.
    - 제한된 메모리 공간을 적절하게 이용하는 역할
- CPU가 가상 메모리에 다시 접근하면, MMU는 해당 가상 메모리를 물리 메모리의 어떤 지점에 저장했는지를 기억해서 가져다 줌

![Untitled](%E1%84%80%E1%85%A1%E1%84%89%E1%85%A1%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%86%E1%85%A9%205dc9d/Untitled%201.png)

- CPU도 메모리를 보는 관점이 프로그래머랑 똑같음

### 느린 속도의 개선

- 단순히 RAM의 크기를 넘어가는 프로세스(2GB라고 하자) 를 하드 디스크로 할당해버리면, RAM으로 처리할 때는 빨랐던 속도가, 하드디스크로 넘어오는 순간 느려지는 문제가 발생하게 됨

![Untitled](%E1%84%80%E1%85%A1%E1%84%89%E1%85%A1%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%86%E1%85%A9%205dc9d/Untitled%202.png)

- 따라서, 하드디스크와 RAM의 관계를 **cache관계**로 구성함. 전체 프로세스의 크기(2GB)를 하드 디스크에 전부 넣음.
- 그 후에, Special Locality와 Temporal Locality에 의해 블럭 단위로 내가 필요한 것을 RAM에다 가져다 놓고 실행시킴

![Untitled](%E1%84%80%E1%85%A1%E1%84%89%E1%85%A1%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%86%E1%85%A9%205dc9d/Untitled%203.png)

- 새로운 할당을 CPU가 요구하면, 특정 알고리즘에 의해 가장 오랫동안 사용되지 않은 블락 등을 하드디스크에 옮겨 놓고(Store) 새로운 블럭을 RAM으로 가져옴
- 다시 하드 디스크에 옮겨 놓은 놈을 요구하면, RAM 안에서 또 특정 알고리즘에 의해 블락을 하드 디스크에 옮겨 놓고(Store) 하드 디스크에 있던 블럭을 RAM(Load)으로 가져옴.
- 이런 파일을 **스왑 파일**이라고 부름

# 하드 디스크의 남은 용량이 중요한 이유..!